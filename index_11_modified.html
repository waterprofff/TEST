<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–ü—Ä–∞–π—Å –ë–´–¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="./css/style.css" />


<!-- ===== Styles from index (10).html ===== -->
<style>
/* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤–∏–Ω–∫–∏" */
label[for="showNewOnly"],
label:has(#showNewOnly),
#showNewOnly + label {
  font-weight: bold;           /* –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç */
  font-size: 15px;             /* —á—É—Ç—å –∫—Ä—É–ø–Ω–µ–µ */

  cursor: pointer;             /* –∫—É—Ä—Å–æ—Ä "—Ä—É–∫–∞" –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
}

/* –ß–µ–∫–±–æ–∫—Å ‚Äî —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –∏ —Å –æ—Ç—Å—Ç—É–ø–æ–º */
#showNewOnly {
  transform: scale(1.2);
  margin-right: 6px;
}
/* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ "–ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä */
label[for="showDistributorOnly"],
label:has(#showDistributorOnly),
#showDistributorOnly + label {
  font-weight: bold;           /* –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç */
  font-size: 15px;             /* —á—É—Ç—å –∫—Ä—É–ø–Ω–µ–µ */

  cursor: pointer;             /* –∫—É—Ä—Å–æ—Ä "—Ä—É–∫–∞" –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
}

/* –ß–µ–∫–±–æ–∫—Å ‚Äî —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –∏ —Å –æ—Ç—Å—Ç—É–ø–æ–º */
#showDistributorOnly {
  transform: scale(1.2);
  margin-right: 6px;
}
</style>

<style>
			/* –æ–≤–µ—Ä–ª–µ–π –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ */
			.zoom-overlay {
			    position: fixed;
			    inset: 0;
			    background: rgba(0, 0, 0, 0.6);
			    display: flex;
			    align-items: center;
			    justify-content: center;
			    z-index: 1000;
			}
			.zoom-overlay img {
			    max-width: 96vw;
			    max-height: 96vh;
			    box-shadow: 0 8px 40px rgba(0, 0, 0, 0.35);
			    border-radius: 10px;
			    cursor: zoom-out;
			    background: #fff;
			}

			/* —Å–∫—Ä—ã—Ç—å –ª—é–±—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ (–Ω–µ—Ç —Ç–µ–∫—Å—Ç–∞, –∫–∞—Ä—Ç–∏–Ω–æ–∫ –∏ —Å—Å—ã–ª–æ–∫) */
			table.price tbody tr:not(:has(td:not(:empty), td img, td a)) {
			    display: none;
			}

			:root {
			    --bg: #ffffff;
			    --text: #111;
			    --muted: #555;
			    --line: #e5e7eb;
			    --accent: #0d9488;
			    --thead: #f7fafc;
			    --hover: #fff9c4;
			}
			* {
			    box-sizing: border-box;
			}
			html,
			body {
			    height: 100%;
			}
			body {
			    margin: 0;
			    background: var(--bg);
			    color: var(--text);
			    font: 14px/1.45 system-ui, Segoe UI, Roboto, Arial, sans-serif;
			}
			.header {
			    position: sticky;
			    top: 0;
			    z-index: 200; /* –±—ã–ª–æ 10 */
			    display: flex;
			    gap: 0.6rem;
			    align-items: center;
			    flex-wrap: wrap;
			    padding: 10px 14px;
			    background: #fff;
			    border-bottom: 1px solid var(--line);
			    backdrop-filter: saturate(120%) blur(4px);
			}
			.header .title {
			    font-weight: 800;
			    font-size: 18px;
			    margin-right: auto;
			}
			.header input[type="search"] {
			    flex: 1;
			    min-width: 240px;
			    max-width: 600px;
			    padding: 0.7rem 0.9rem;
			    border: 1px solid #b7e4c7;
			    border-radius: 0.6rem;
			    background: #e9f5ee;
			    color: #111;
			    outline: none;
			    font-size: 16px;
			}
			.header .btn {
			    padding: 0.55rem 0.8rem;
			    border: 1px solid #cbd5e1;
			    border-radius: 0.6rem;
			    background: #fff;
			    cursor: pointer;
			}
			.header .btn.primary {
			    background: #16a34a;
			    color: #fff;
			    border-color: #16a34a;
			}
			.header .group {
			    display: flex;
			    gap: 0.4rem;
			    align-items: center;
			}
			.container {
			    padding: 16px;
			}
			:root {
			    --header-offset: 0px;
			} /* –æ—Ç—Å—Ç—É–ø –¥–ª—è thead ‚Äî –∑–∞–¥–∞—ë–º –∏–∑ JS */

			.tblwrap {
			    overflow: visible !important;
			    position: relative;
			}

			/* –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã –≤—Å–µ–≥–¥–∞ –ø–æ–¥ —à–∞–ø–∫–æ–π */
			table.price thead th {
			    position: sticky;
			    top: var(--header-offset); /* <‚Äî –Ω–∏—á–µ–≥–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ 62px */
			    z-index: 150;
			    background: #f8fafc;
			    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);
			}

			/* –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ ¬´–∑–∞–ª–∏–ø–∞–Ω–∏–µ¬ª –ø–µ—Ä–≤–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ */
			th:first-child,
			td:first-child {
			    position: sticky;
			    left: 0;
			    background: #fff;
			    z-index: 140;
			}

			h2 {
			    margin: 18px 0 8px 0;
			    font-size: 18px;
			}
			.tblwrap {
			    overflow: auto;
			    border: 1px solid var(--line);
			    border-radius: 12px;
			    background: #fff;
			}
			table.price {
			    width: 100%;
			    border-collapse: separate;
			    border-spacing: 0;
			}
			thead th {
			    position: sticky;
			    top: 62px;
			    background: var(--thead);
			    border-bottom: 1px solid var(--line);
			    padding: 10px;
			    text-align: left;
			    z-index: 1;
			}
			tbody td {
			    border-bottom: 1px solid var(--line);
			    padding: 8px 10px;
			    vertical-align: middle;
			}
			tbody tr:hover {
			    background: var(--hover);
			}
			th:first-child,
			td:first-child {
			    position: sticky;
			    left: 0;
			    background: inherit;
			}
			.imgcell {
			    width: 220px;
			}
			.imgcell img {
			    max-width: 72px;
			    max-height: 72px;
			    border-radius: 6px;
			    cursor: zoom-in;
			    display: block;
			    margin: auto;
			}
			a.urla {
			    display: inline-block;
			    padding: 0.35rem 0.55rem;
			    border: 1px solid #cbd5e1;
			    border-radius: 0.55rem;
			    background: #fff;
			    color: #111;
			    text-decoration: none;
			    font-weight: 600;
			}
			a.urla:hover {
			    border-color: #16a34a;
			}
			.count {
			    opacity: 0.75;
			    margin-left: 8px;
			}
			.toolbar {
			    display: flex;
			    flex-wrap: wrap;
			    gap: 0.5rem;
			    align-items: center;
			    margin-top: 0.5rem;
			}
			.toolbar label {
			    font-weight: 600;
			}
			.input-small {
			    width: 6rem;
			    padding: 0.45rem 0.5rem;
			    border: 1px solid #cbd5e1;
			    border-radius: 0.5rem;
			}
			.sticky-top {
			    position: sticky;
			    top: 0;
			    background: #fff;
			    z-index: 9;
			}
			.small {
			    font-size: 12px;
			    color: var(--muted);
			}
			footer {
			    padding: 28px 18px;
			    color: #777;
			    border-top: 1px solid var(--line);
			}
		</style>

<style>
			:root {
			    --header-offset: 0px;
			}
			.header {
			    z-index: 200 !important;
			}
			.tblwrap {
			    overflow: visible !important;
			    position: relative;
			}
			table.price thead th {
			    position: sticky;
			    top: var(--header-offset);
			    z-index: 150;
			    background: #f8fafc;
			    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);
			}
			td.imgcell {
			    text-align: center;
			}
			td.imgcell img {
			    display: block;
			    margin: auto;
			}
		</style>

<style>
			tr.subcat td {
			    font-weight: 700;
			    background: #fff7c2; /* –º—è–≥–∫–æ-–∂—ë–ª—Ç—ã–π */
			}
		</style>

<style>
    /* Summary rows (general and distributor counts) have similar styling to categories */
    tr.summary-row td {
        font-weight: 700;
        background: #fff7c2;
    }
</style>

<style>
			td.promo {
			    background: #ffe4e1;
			    font-weight: 700;
			    color: #b22222;
			}
		</style>

<style>
			.only-promo-filter {
			    margin: 10px 0;
			    font-weight: bold;
			}
		</style>

<style>
			th .promo-toggle {
			  display: inline-flex;
			  align-items: center;
			  gap: 6px;
			  margin-left: 8px;
			  padding: 4px 8px;
			  border: 1px solid #f59e0b;
			  background: #fff7ed; /* –∑–∞–º–µ—Ç–Ω—ã–π –ø–µ—Ä—Å–∏–∫–æ–≤—ã–π */
			  color: #9a3412;
			  border-radius: 999px;
			  font-weight: 700;
			  font-size: 12px;
			  cursor: pointer;
			  user-select: none;
			  box-shadow: 0 1px 0 rgba(0,0,0,.06);
			}
			th .promo-toggle input[type="checkbox"] {
			  accent-color: #f59e0b;
			  width: 16px;
			  height: 16px;
			}
		</style>

<style>
			.distributor-row td { background-color: #e8f6ff; }
		</style>

<style>
			/* Pill-styled "–¢–æ–ª—å–∫–æ –∞–∫—Ü–∏–∏" toggle inside the header */
			th .promo-toggle {
			  display: inline-flex;
			  align-items: center;
			  gap: 8px;
			  margin-left: 8px;
			  padding: 6px 12px;
			  border: 2px solid #f59e0b;
			  background: #fff7ed;
			  color: #9a3412;
			  border-radius: 999px;
			  font-weight: 700;
			  font-size: 13px;
			  cursor: pointer;
			  user-select: none;
			  box-shadow: 0 1px 0 rgba(0,0,0,.06);
			}
			th .promo-toggle input[type="checkbox"] {
			  accent-color: #f59e0b;
			  width: 16px;
			  height: 16px;
			  margin: 0;
			}
			/* Make price column easily findable */
			td.price { white-space: nowrap; }
		</style>

<style>
			/* Pill-styled promo toggle in header */
			.promo-toggle{
			  display:inline-flex;align-items:center;gap:8px;
			  margin-left:8px;padding:6px 12px;
			  border:2px solid #f59e0b;background:#fff7ed;color:#9a3412;
			  border-radius:999px;font-weight:700;font-size:13px;cursor:pointer;user-select:none
			}
			.promo-toggle input{accent-color:#f59e0b;width:16px;height:16px;margin:0}
		</style>

<style>
			/* Pill-styled promo toggle in header */
			.promo-toggle{
			  display:inline-flex;align-items:center;gap:8px;
			  margin-left:8px;padding:6px 12px;
			  border:2px solid #f59e0b;background:#fff7ed;color:#9a3412;
			  border-radius:999px;font-weight:700;font-size:13px;cursor:pointer;user-select:none
			}
			.promo-toggle input{accent-color:#f59e0b;width:16px;height:16px;margin:0}
		</style>

<style>
			/* Pill-styled promo toggle in header */
			.promo-toggle{
			  display:inline-flex;align-items:center;gap:8px;
			  margin-left:8px;padding:6px 12px;
			  border:2px solid #f59e0b;background:#fff7ed;color:#9a3412;
			  border-radius:999px;font-weight:700;font-size:13px;cursor:pointer;user-select:none
			}
			.promo-toggle input{accent-color:#f59e0b;width:16px;height:16px;margin:0}
		</style>

<style>
			/* –°—Ç–∏–ª–∏ –¥–ª—è –∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–Ω */
			td.promo {
			  font-weight: 700;
			  color: #d32f2f;
			  background: #fff0f0;
			  position: relative;
			}
			td.price.old {
			  text-decoration: line-through;
			  color: #777;
			}
			td.promo::before {
			  content: "–ê–∫—Ü–∏—è";
			  position: absolute;
			  top: 4px;
			  left: 4px;
			  background: #f59e0b;
			  color: #fff;
			  font-size: 11px;
			  font-weight: bold;
			  padding: 2px 6px;
			  border-radius: 6px;
			}
		</style>

<style>
			.zoom-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85);
			  display: none; align-items: center; justify-content: center; z-index: 1000; }
			.zoom-overlay img { max-width: 90%; max-height: 90%; border-radius: 8px; box-shadow: 0 8px 30px rgba(0,0,0,0.5); }
			.nav-btn { position: absolute; top: 50%; transform: translateY(-50%);
			  background: rgba(255,255,255,0.7); border: none; font-size: 32px; padding: 8px 14px;
			  cursor: pointer; border-radius: 50%; }
			.prev-btn { left: 20px; }
			.next-btn { right: 20px; }
			.nav-btn:hover { background: rgba(255,255,255,0.9); }
		</style>

<style>
			.zoom-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85);
			  display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
			.zoom-overlay img { max-width: 90%; max-height: 80%; border-radius: 8px; box-shadow: 0 8px 30px rgba(0,0,0,0.5); }
			.zoom-caption { margin-top: 12px; color: #fff; font-size: 16px; font-weight: 600; text-align: center; max-width: 90%; }
			.nav-btn { position: absolute; top: 50%; transform: translateY(-50%);
			  background: rgba(255,255,255,0.7); border: none; font-size: 32px; padding: 8px 14px;
			  cursor: pointer; border-radius: 50%; }
			.prev-btn { left: 20px; }
			.next-btn { right: 20px; }
			.nav-btn:hover { background: rgba(255,255,255,0.9); }
		</style>

<style>
			.zoom-overlay button {
			  position: absolute;
			  top: 50%;
			  transform: translateY(-50%);
			  background: rgba(255,255,255,0.2);
			  border: none;
			  color: white;
			  font-size: 2rem;
			  padding: 0.5rem 1rem;
			  cursor: pointer;
			}
			.zoom-overlay button.prev { left: 20px; }
			.zoom-overlay button.next { right: 20px; }
		</style>

<style>
			/* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–æ–≤–∏–Ω–æ–∫ */
			tr.new-item td { background: #e6ffed !important; }
			tr.new-item td:first-child::before { content: "–ù–æ–≤–∏–Ω–∫–∞ "; color: #047857; font-weight: 700; }
		</style>

<style>/* –ß–µ—Ä–Ω–∞—è –ü—è—Ç–Ω–∏—Ü–∞ üñ§ —Å—Ç–∏–ª–∏ */
td.bf{background:#f1f5f9;font-weight:800;color:#0f172a;position:relative;white-space:nowrap}
/* show üñ§ only when BF cell is not empty */
td.bf:not(:empty)::after{content:" \1F5A4";font-weight:900}
</style>

<style>body{font-family:Arial,sans-serif}tr.subcat td{font-weight:bold;background:#fff7c2}td,th{border:1px solid #ddd;padding:4px}table{border-collapse:collapse;width:100%}img{max-width:90px;max-height:90px;border-radius:6px}</style>

</head>
<body>

  <script>
    // –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–∞–π—Å ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ:
   <!-- // document.getElementById("maintenance-overlay").style.display = "none"; **-->
  </script>

  <!-- –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–±—É–¥–µ—Ç –ø–æ–¥ –∑–∞–≥–ª—É—à–∫–æ–π, –Ω–æ —É–∂–µ –≥–æ—Ç–æ–≤) -->
  <h1>–ü—Ä–∞–π—Å –ë–´–¢</h1>

  <div class="controls">
    <label for="discount">–°–∫–∏–¥–∫–∞, %</label>
    <input id="discount" type="number" min="0" max="99" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 10" />
    <button id="applyDiscount">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å</button>
    <button id="resetDiscount">–°–±—Ä–æ—Å</button>
  </div>

  <table class="price">
    <thead>
      <tr>
        <th>–ê—Ä—Ç–∏–∫—É–ª</th>
        <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
        <th>—É–ø–∞–∫., —à—Ç.</th>
        <th>–ø–∞–ª–µ—Ç–∞, —à—Ç.</th>
        <th>–¶–µ–Ω–∞, —Ä—É–±. —Å –ù–î–° 20%</th>
        <th>–ê–∫—Ü–∏—è, —Ä—É–±.</th>
        <th>–§–æ—Ç–æ</th>
        <th>–ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞</th>
      </tr>
    </thead>
    <tbody id="price-body"
      data-csv-url="https://docs.google.com/spreadsheets/d/14WyLMRfoAQaJ5ShXM0QFjd2K_iLueFMejbhQns66gcw/export?format=csv&gid=1862196171"
      data-list="byt">
      <!-- –¢–æ–≤–∞—Ä—ã —Å—é–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç JS -->
    </tbody>
  </table>

  <style>
    /* –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥–ª—É—à–∫–∏ */
    #maintenance-overlay {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at top, #f0f6ff, #dde6f7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    .maintenance-window {
      background: white;
      padding: 24px 32px;
      border-radius: 16px;
      box-shadow: 0 12px 35px rgba(0,0,0,0.15);
      max-width: 360px;
    }
    .maintenance-window .emoji {
      font-size: 48px;
      margin-bottom: 10px;
      animation: spin 3s infinite linear;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to   { transform: rotate(360deg); }
    }
  </style>

  <script src="./js/price-v2.js" defer></script>


<!-- ===== Scripts from index (10).html ===== -->
<script>
			// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–º–µ—á–∞–µ–º —Å—Ç–∞—Ä—É—é —Ü–µ–Ω—É –∫–∞–∫ –∑–∞—á—ë—Ä–∫–Ω—É—Ç—É—é, –µ—Å–ª–∏ —Ä—è–¥–æ–º –µ—Å—Ç—å td.promo
			window.addEventListener('DOMContentLoaded', () => {
			  document.querySelectorAll('table.price tbody tr').forEach(row => {
			    const promoCell = row.querySelector('td.promo');
			    if (promoCell && promoCell.textContent.trim() !== '') {
			      const priceCell = row.querySelector('td.price');
			      if (priceCell) {
			        priceCell.classList.add('old');
			      }
			    }
			  });
			});
		</script>

<script>
			(function(){
			  let currentDiscount = 0;
			  let cachedRows = [];

			  function formatRU(n){ return new Intl.NumberFormat("ru-RU").format(n); }

			  function ensurePromoToggle(){
			    const promoTh = Array.from(document.querySelectorAll("table.price thead th"))
			      .find(th => (th.textContent||"").toUpperCase().includes("–ê–ö–¶–ò–Ø"));
			    if (!promoTh) return;
			    promoTh.querySelectorAll("label.promo-toggle").forEach(x=>x.remove());
			    const label = document.createElement("label");
			    label.className = "promo-toggle";
			    const cb = document.createElement("input");
			    cb.type = "checkbox"; cb.id = "promoOnly";
			    label.appendChild(cb);
			    label.append("–¢–æ–ª—å–∫–æ –∞–∫—Ü–∏–∏");
			    promoTh.appendChild(label);
			    cb.addEventListener("change", applyFilters);
			  }

  /**
   * –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö —Ü–µ–Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ (–†–†–¶, –∞–∫—Ü–∏—è, –ß–µ—Ä–Ω–∞—è –ü—è—Ç–Ω–∏—Ü–∞).
   * –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∏ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å —Å–∫–∏–¥–∫—É. –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞
   * –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ —è—á–µ–π–∫–∞–º –ø–æ CSS‚Äë–∫–ª–∞—Å—Å–∞–º, –∞ –Ω–µ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º: —Ç–∞–∫ –∫–æ–¥ –Ω–µ —Å–ª–æ–º–∞–µ—Ç—Å—è,
   * –µ—Å–ª–∏ –ø–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–ª–±—Ü–æ–≤ –∏–∑–º–µ–Ω–∏—Ç—Å—è.
   */
  function cacheBasePrices(){
    const tbody = document.querySelector("table.price tbody");
    // –∫–ª–æ–Ω–∏—Ä—É–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ tbody –≤ –∫—ç—à (–≤–∫–ª—é—á–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ç–æ–≤–∞—Ä—ã –∏ —Ç.–ø.)
    cachedRows = Array.from(tbody.querySelectorAll("tr")).map(tr => tr.cloneNode(true));
    // –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏–º –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Ü–µ–Ω–æ–≤—ã—Ö —è—á–µ–µ–∫
    cachedRows.forEach(tr => {
      // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–≤–æ–¥–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∏–º–µ—é—Ç —è—á–µ–µ–∫ —Å —Ü–µ–Ω–∞–º–∏
      if (tr.classList.contains('summary-row')) return;
      const priceCell = tr.querySelector('td.price');
      const promoCell = tr.querySelector('td.promo');
      const bfCell   = tr.querySelector('td.bf');
      if (priceCell && !priceCell.dataset.base){
        const val = parseFloat((priceCell.textContent||'').replace(/\s+/g,'').replace(',', '.'));
        if (!isNaN(val)) priceCell.dataset.base = String(val);
      }
      if (promoCell && !promoCell.dataset.base){
        const val = parseFloat((promoCell.textContent||'').replace(/\s+/g,'').replace(',', '.'));
        if (!isNaN(val)) promoCell.dataset.base = String(val);
      }
      if (bfCell && !bfCell.dataset.base){
        const val = parseFloat((bfCell.textContent||'').replace(/\s+/g,'').replace(',', '.'));
        if (!isNaN(val)) bfCell.dataset.base = String(val);
      }
    });
  }

  /**
   * –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Å–∫–∏–¥–∫—É –∫–æ –≤—Å–µ–º —Ü–µ–Ω–æ–≤—ã–º —è—á–µ–π–∫–∞–º (–†–†–¶, –∞–∫—Ü–∏—è, –ß–ü).
   * –°–≤–æ–¥–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏ —Å—Ç—Ä–æ–∫–∏‚Äë–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º. –ó–Ω–∞—á–µ–Ω–∏–µ –æ–∫—Ä—É–≥–ª—è–µ—Ç—Å—è –¥–æ —Ü–µ–ª–æ–≥–æ.
   */
  function applyDiscountNow(tbody){
    tbody.querySelectorAll("tr").forEach(tr => {
      // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ –∏ —Å–≤–æ–¥–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
      if (tr.classList.contains('subcat') || tr.classList.contains('summary-row')) return;
      const priceCell = tr.querySelector('td.price');
      const promoCell = tr.querySelector('td.promo');
      const bfCell   = tr.querySelector('td.bf');
      // –±–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞
      if (priceCell && priceCell.dataset.base){
        const base = parseFloat(priceCell.dataset.base);
        const val = isNaN(base) ? null : (currentDiscount > 0 ? Math.round(base * (1 - currentDiscount/100)) : base);
        if (val !== null) priceCell.textContent = formatRU(val);
      }
      // –∞–∫—Ü–∏–æ–Ω–Ω–∞—è —Ü–µ–Ω–∞
      if (promoCell && promoCell.dataset.base){
        const base = parseFloat(promoCell.dataset.base);
        // –µ—Å–ª–∏ –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ, –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ–º; –∏–Ω–∞—á–µ –æ—Å—Ç–∞–≤–∏–º –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        if (!isNaN(base)){
          const val = currentDiscount > 0 ? Math.round(base * (1 - currentDiscount/100)) : base;
          promoCell.textContent = formatRU(val);
        }
      }
      // —Ü–µ–Ω–∞ –ß—ë—Ä–Ω–æ–π –ü—è—Ç–Ω–∏—Ü—ã
      if (bfCell && bfCell.dataset.base){
        const base = parseFloat(bfCell.dataset.base);
        if (!isNaN(base)){
          const val = currentDiscount > 0 ? Math.round(base * (1 - currentDiscount/100)) : base;
          bfCell.textContent = formatRU(val);
        }
      }
      // –∑–∞—á—ë—Ä–∫–∏–≤–∞–µ–º –†–†–¶, –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ü–∏—è –∏–ª–∏ –ß–ü
      if (priceCell){
        const hasPromo = !!(promoCell && promoCell.textContent.trim());
        const hasBF    = !!(bfCell && bfCell.textContent.trim());
        if (hasPromo || hasBF) priceCell.classList.add('old');
        else priceCell.classList.remove('old');
      }
    });
  }

  /**
   * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∞–π—Å–∞. –£—á–∏—Ç—ã–≤–∞–µ—Ç:
   * - —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (–ø–æ–ª–µ –ø–æ–∏—Å–∫–∞)
   * - —Ç–æ–ª—å–∫–æ –Ω–æ–≤–∏–Ω–∫–∏ (—á–µ–∫–±–æ–∫—Å showNewOnly)
   * - —Ç–æ–ª—å–∫–æ –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä (showDistributorOnly)
   * - —Ç–æ–ª—å–∫–æ –∞–∫—Ü–∏–∏ (promoOnly) ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ –∞–∫—Ü–∏–∏, —Ç–∞–∫ –∏ –ß–ü
   * - —Ç–æ–ª—å–∫–æ –ß–ü (bfOnly)
   * –ü–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –¥–≤–µ –≥—Ä—É–ø–ø—ã (–æ–±—â–∏–π –∏ –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä), —Å–∫—Ä—ã–≤–∞–µ—Ç –ø—É—Å—Ç—ã–µ
   * –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–≤–æ–¥–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–∑–∏—Ü–∏–π.
   */
  function applyFilters(){
    const tbody = document.querySelector('table.price tbody');
    const qEl = document.getElementById('q') || document.getElementById('searchInput');
    const searchVal = (qEl && qEl.value ? qEl.value : '').toLowerCase().trim();
    const newOnly = !!(document.getElementById('showNewOnly') && document.getElementById('showNewOnly').checked);
    const distOnly = !!(document.getElementById('showDistributorOnly') && document.getElementById('showDistributorOnly').checked);
    const promoOnly = !!(document.getElementById('promoOnly') && document.getElementById('promoOnly').checked);
    const bfOnly   = !!(document.getElementById('bfOnly') && document.getElementById('bfOnly').checked);

    // –¥–≤–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –±–ª–æ–∫–æ–≤ (–∫–∞—Ç–µ–≥–æ—Ä–∏—è + —Ç–æ–≤–∞—Ä—ã)
    let general = [];
    let distributor = [];
    let currentCat = null;
    let currentIsDistributor = false;
    let buffer = [];
    // –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ true, –∫–æ–≥–¥–∞ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—Å—è –ø–µ—Ä–≤–∞—è —Ç–æ–≤–∞—Ä–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä–∞ (–∞—Ä—Ç–∏–∫—É–ª 30509 –∏ –¥–∞–ª–µ–µ)
    let foundFirstDistributorRow = false;

    function flush(){
      if (buffer.length && currentCat){
        const block = [currentCat.cloneNode(true), ...buffer];
        if (!currentIsDistributor) general.push(block);
        else distributor.push(block);
      }
      buffer = [];
    }

    cachedRows.forEach(row => {
      // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–≤–æ–¥–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
      if (row.classList.contains('summary-row')) return;
      if (row.classList.contains('subcat')){
        // –Ω–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
        if (currentCat) flush();
        currentCat = row.cloneNode(true);
        // –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∫ –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä—É, –µ—Å–ª–∏ —Ä–∞–Ω–µ–µ —É–∂–µ –≤—Å—Ç—Ä–µ—Ç–∏–ª—Å—è –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä–∞
        currentIsDistributor = foundFirstDistributorRow;
      } else {
        // —Ç–æ–≤–∞—Ä–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
        const text = (row.textContent || '').toLowerCase();
        const rowIsNew = row.classList.contains('new-item');
        const rowIsDist = row.classList.contains('distributor-row');
        const promoCell = row.querySelector('td.promo');
        const bfCell    = row.querySelector('td.bf');
        const hasPromo  = !!(promoCell && promoCell.textContent.trim());
        const hasBF     = !!(bfCell && bfCell.textContent.trim());
        // –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä–∞, –ø–æ–º–µ—á–∞–µ–º —Ç–µ–∫—É—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∫–∞–∫ –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä—Å–∫–∏–µ
        if (!foundFirstDistributorRow && rowIsDist){
          foundFirstDistributorRow = true;
          currentIsDistributor = true;
        }
        let match = true;
        if (searchVal && !text.includes(searchVal)) match = false;
        if (newOnly && !rowIsNew) match = false;
        if (distOnly && !rowIsDist) match = false;
        // –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω "–¢–æ–ª—å–∫–æ –∞–∫—Ü–∏–∏", —Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª–∏–±–æ –ø—Ä–æ–º–æ, –ª–∏–±–æ –ß–ü
        if (promoOnly && !(hasPromo || hasBF)) match = false;
        // –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω "–¢–æ–ª—å–∫–æ –ß–ü", —Ç–æ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ß–ü
        if (bfOnly && !hasBF) match = false;
        if (match){
          // –∫–ª–æ–Ω–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –±—É—Ñ–µ—Ä
          buffer.push(row.cloneNode(true));
        }
      }
    });
    // –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    if (currentCat) flush();

    // –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Array.flat(), —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã
    let genCount = 0;
    general.forEach(block => {
      block.forEach(r => {
        if (!r.classList.contains('subcat')) genCount++;
      });
    });
    let distCount = 0;
    distributor.forEach(block => {
      block.forEach(r => {
        if (!r.classList.contains('subcat')) distCount++;
      });
    });

    // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
    tbody.innerHTML = '';
    // —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (–æ–±—â–∏–π)
    const generalSummary = document.createElement('tr');
    generalSummary.className = 'summary-row';
    generalSummary.setAttribute('data-summary','general');
    generalSummary.innerHTML = `<td colspan="10"><b>–û–±—â–∏–π (${genCount} –ø–æ–∑.)</b></td>`;
    tbody.appendChild(generalSummary);
    // –≤—Å—Ç–∞–≤–ª—è–µ–º –≤—Å–µ –±–ª–æ–∫–∏ –∏–∑ general
    general.forEach(block => {
      block.forEach(r => tbody.appendChild(r));
    });
    // —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä–∞
    const distSummary = document.createElement('tr');
    distSummary.className = 'summary-row';
    distSummary.setAttribute('data-summary','distributor');
    distSummary.innerHTML = `<td colspan="10"><b>–î–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä (${distCount} –ø–æ–∑.)</b></td>`;
    tbody.appendChild(distSummary);
    // –≤—Å—Ç–∞–≤–ª—è–µ–º –±–ª–æ–∫–∏ –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä–∞
    distributor.forEach(block => {
      block.forEach(r => tbody.appendChild(r));
    });

    // –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫—É –∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–º —Å—Ç—Ä–æ–∫–∞–º
    applyDiscountNow(tbody);
  }

			  function bindButtons(){
			    const applyBtn = document.getElementById("applyDiscount");
			    const resetBtn = document.getElementById("resetDiscount");
			    const xlsBtn = document.getElementById("downloadXls");
			    const pdfBtn = document.getElementById("downloadPdf");
			    const qEl = document.getElementById("q") || document.getElementById("searchInput");

			    if (applyBtn){
			      applyBtn.addEventListener("click", ()=>{
			        const input = document.getElementById("discount") || document.getElementById("discountInput");
			        const val = parseFloat(input && input.value ? input.value : "0");
			        currentDiscount = isNaN(val) ? 0 : Math.max(0, Math.min(99, val));
			        if (input) input.value = String(currentDiscount);
			        applyFilters();
			      });
			    }
			    if (resetBtn){
			      resetBtn.addEventListener("click", ()=>{
			        const input = document.getElementById("discount") || document.getElementById("discountInput");
			        if (input) input.value = "0";
			        currentDiscount = 0;
			        applyFilters();
			      });
			    }
			    if (qEl){
			      qEl.addEventListener("input", applyFilters);
			      qEl.addEventListener("search", applyFilters);
			    }

    // —Ä–µ–∞–≥–∏—Ä—É–µ–º –Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: –Ω–æ–≤–∏–Ω–∫–∏, –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä, –ß–ü
    const newCb  = document.getElementById('showNewOnly');
    if (newCb) newCb.addEventListener('change', applyFilters);
    const distCb = document.getElementById('showDistributorOnly');
    if (distCb) distCb.addEventListener('change', applyFilters);
    const bfCb = document.getElementById('bfOnly');
    if (bfCb) bfCb.addEventListener('change', applyFilters);

			    function cloneVisibleTable(forExcel=false){
			      const table = document.querySelector("table.price");
			      const clone = table.cloneNode(true);
			      if (forExcel){
			        clone.querySelectorAll("td.imgcell img").forEach(img=>img.remove());
			      }
			      clone.querySelectorAll("tr.subcat td").forEach(td=>{
			        td.setAttribute("style","background:#fff7c2;font-weight:bold;");
			      });
			      clone.querySelectorAll("td,th").forEach(cell=>{
			        const prev = cell.getAttribute("style")||"";
			        cell.setAttribute("style",(prev?prev+";":"")+"border:1px solid #ddd;padding:4px;");
			      });
			      return clone.outerHTML;
			    }

			    function downloadExcel(){
			      const html = cloneVisibleTable(true);
			      const blob = new Blob([`\ufeff<html><head><meta charset="utf-8"></head><body>${html}</body></html>`],{type:"application/vnd.ms-excel"});
			      const url = URL.createObjectURL(blob);
			      const a = document.createElement("a");
			      a.href=url;a.download="price.xls";document.body.appendChild(a);a.click();
			      setTimeout(()=>{URL.revokeObjectURL(url);a.remove();},0);
			    }

			    function downloadPdf(){
			      const html = cloneVisibleTable(false);
			      const w = window.open("","_blank");
			      w.document.open();
			      w.document.write(`<html><head><meta charset="utf-8"><title>–ü—Ä–∞–π—Å</title>
			      <style>body{font-family:Arial,sans-serif}tr.subcat td{font-weight:bold;background:#fff7c2}td,th{border:1px solid #ddd;padding:4px}table{border-collapse:collapse;width:100%}img{max-width:90px;max-height:90px;border-radius:6px}</style>
			      </head><body>${html}</body></html>`);
			      w.document.close();w.focus();w.print();
			    }

			 
			    if (pdfBtn) pdfBtn.addEventListener("click", downloadPdf);
			  }

			  document.addEventListener("DOMContentLoaded", ()=>{
    ensurePromoToggle();
    cacheBasePrices();
    bindButtons();
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Å—Ä–∞–∑—É –∏ –µ—â—ë —Ä–∞–∑ –ø–æ—Å–ª–µ –∫–æ—Ä–æ—Ç–∫–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏,
    // —á—Ç–æ–±—ã —Ç–∞–±–ª–∏—Ü–∞ —É—Å–ø–µ–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ—Å—Ç—Ä–æ–∏—Ç—å—Å—è –¥–æ –ø–æ–¥—Å—á—ë—Ç–∞ —Å—Ç—Ä–æ–∫.
    applyFilters();
    setTimeout(() => {
      try { applyFilters(); } catch(e) {}
    }, 50);
  });
			})();
		</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
			document.addEventListener('DOMContentLoaded', () => {
			  const btnExcel = document.getElementById('downloadXls');
			  const onlyPromo = document.getElementById('onlyPromoExcel');

			  if (btnExcel) {
			    btnExcel.addEventListener('click', () => {
			      const table = document.querySelector('table.price');
			      if (!table) return;

			      // Get rows
			      const rows = Array.from(table.querySelectorAll('tbody tr'))
			        .filter(tr => tr.querySelectorAll('td').length > 0);

			      // Filter only promo if checkbox checked
			      let filteredRows = rows;
			      if (onlyPromo && onlyPromo.checked) {
			        filteredRows = rows.filter(tr => tr.querySelector('td.promo') && tr.querySelector('td.promo').textContent.trim() !== '');
			      }

			      // Build worksheet data
			      const headerCells = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());

			      // Remove –§–æ—Ç–æ column and rename –∞–∫—Ü–∏—è
			      const photoIndex = headerCells.findIndex(h => h.toLowerCase().includes('—Ñ–æ—Ç–æ'));
			      const promoIndex = headerCells.findIndex(h => h.toLowerCase().includes('–∞–∫—Ü–∏—è'));
			      if (photoIndex !== -1) headerCells.splice(photoIndex, 1);
			      if (promoIndex !== -1) headerCells[promoIndex] = '–ê–∫—Ü–∏—è';

			      const data = [headerCells];

// –û–ø—Ä–µ–¥–µ–ª—è–µ–º "—á–∏—Å–ª–æ–≤—ã–µ" –∫–æ–ª–æ–Ω–∫–∏ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
const numericCols = headerCells
  .map((h, idx) => ({ header: h.toLowerCase(), idx }))
  .filter(col => /—Ü–µ–Ω–∞|—Ä—É–±|—É\.–µ\.|—Ä—Ä—Ü|—Å–∫–∏–¥–∫–∞|%|–æ—Å—Ç–∞—Ç–æ–∫|–Ω–∞–ª–∏—á|–∫–æ–ª-–≤–æ|–∫–æ–ª–∏—á–µ—Å—Ç/.test(col.header))
  .map(col => col.idx);

filteredRows.forEach(tr => {
  let tds = Array.from(tr.querySelectorAll('td')).map(td => td.textContent.trim());

  // —É–±–∏—Ä–∞–µ–º –∫–æ–ª–æ–Ω–∫—É –§–æ—Ç–æ, –µ—Å–ª–∏ –µ—Å—Ç—å
  if (photoIndex !== -1) tds.splice(photoIndex, 1);

  // –ø—Ä–∏–≤–æ–¥–∏–º —Ü–µ–Ω—ã / —Å–∫–∏–¥–∫–∏ –∫ —á–∏—Å–ª–∞–º
  tds = tds.map((val, idx) => {
    if (!numericCols.includes(idx)) return val; // –Ω–µ —á–∏—Å–ª–æ–≤–æ–π —Å—Ç–æ–ª–±–µ—Ü

    if (!val) return '';
    // —É–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –∏ –º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É
    const normalized = val.replace(/\s+/g, '').replace(',', '.');
    const num = Number(normalized);
    return Number.isNaN(num) ? val : num;
  });

  data.push(tds);
});


			      // Export using SheetJS
			      const ws = XLSX.utils.aoa_to_sheet(data);
			      const wb = XLSX.utils.book_new();
			      XLSX.utils.book_append_sheet(wb, ws, '–ü—Ä–∞–π—Å');
			      XLSX.writeFile(wb, 'price.xlsx');
			    });
			  }
			});
		</script>

<script>
			// –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –ø–æ –º–∏–Ω–∏–∞—Ç—é—Ä–∞–º
			document.addEventListener('DOMContentLoaded', () => {
			  const overlay = document.createElement('div');
			  overlay.className = 'zoom-overlay';
			  overlay.style.display = 'none';
			  overlay.style.position = 'fixed';
			  overlay.style.top = 0;
			  overlay.style.left = 0;
			  overlay.style.width = '100%';
			  overlay.style.height = '100%';
			  overlay.style.background = 'rgba(0,0,0,0.8)';
			  overlay.style.justifyContent = 'center';
			  overlay.style.alignItems = 'center';
			  overlay.style.zIndex = 1000;
			  overlay.innerHTML = '<img style="max-width:90%;max-height:90%"><button class="prev">‚óÄ</button><button class="next">‚ñ∂</button>';
			  document.body.appendChild(overlay);

			  const overlayImg = overlay.querySelector('img');
			  const prevBtn = overlay.querySelector('.prev');
			  const nextBtn = overlay.querySelector('.next');
			  let currentIndex = -1;
			  let visibleImages = [];

			  function updateVisibleImages() {
			    visibleImages = Array.from(document.querySelectorAll('.imgcell img')).filter(img => img.offsetParent !== null);
			  }

			  function showOverlay(img) {
			    updateVisibleImages();
			    currentIndex = visibleImages.indexOf(img);
			    if (currentIndex === -1) return;
			    overlayImg.src = img.src;
			    overlay.style.display = 'flex';
			  }

			  document.addEventListener('click', e => {
			    if (e.target.matches('.imgcell img')) {
			      e.preventDefault();
			      showOverlay(e.target);
			    }
			  });

			  function showNext() {
			    if (visibleImages.length === 0) return;
			    currentIndex = (currentIndex + 1) % visibleImages.length;
			    overlayImg.src = visibleImages[currentIndex].src;
			  }

			  function showPrev() {
			    if (visibleImages.length === 0) return;
			    currentIndex = (currentIndex - 1 + visibleImages.length) % visibleImages.length;
			    overlayImg.src = visibleImages[currentIndex].src;
			  }

			  nextBtn.addEventListener('click', showNext);
			  prevBtn.addEventListener('click', showPrev);
			  overlay.addEventListener('click', e => {
			    if (e.target === overlay) overlay.style.display = 'none';
			  });

			  document.addEventListener('keydown', e => {
			    if (overlay.style.display === 'flex') {
			      if (e.key === 'Escape') overlay.style.display = 'none';
			      if (e.key === 'ArrowRight') showNext();
			      if (e.key === 'ArrowLeft') showPrev();
			    }
			  });
			});
		</script>

<script>
// === Unified filtering: search, only new, only distributor, keep categories === (disabled by patch)
document.addEventListener('DOMContentLoaded', () => {
  const qInput = document.getElementById('q');
  const newOnlyCb = document.getElementById('showNewOnly');
  const distOnlyCb = document.getElementById('showDistributorOnly');
  const tbody = document.querySelector('table.price tbody');

  function textOfRow(tr){
    // Collect text from tds (exclude img/links)
    const clone = tr.cloneNode(true);
    clone.querySelectorAll('img,a,button').forEach(n=>n.remove());
    return clone.textContent.trim().toLowerCase();
  }

  function applyFilters(){
    if (!tbody) return;
    const q = (qInput && qInput.value ? qInput.value.trim().toLowerCase() : "");
    const newOnly = !!(newOnlyCb && newOnlyCb.checked);
    const distOnly = !!(distOnlyCb && distOnlyCb.checked);

    let groups = [];
    let header = null;
    let rows = [];

    const allRows = Array.from(tbody.querySelectorAll('tr'));
    allRows.forEach(tr => {
      if (tr.classList.contains('subcat')){
        if (header !== null){
          groups.push({header, rows});
        }
        header = tr;
        rows = [];
      } else {
        rows.push(tr);
      }
    });
    if (header !== null){
      groups.push({header, rows});
    }

    groups.forEach(({header, rows}) => {
      let visibleInGroup = 0;
      rows.forEach(tr => {
        // skip empties (but they shouldn't be many)
        let show = true;
        if (newOnly && !tr.classList.contains('new-item')) show = false;
        if (distOnly && !tr.classList.contains('distributor-row')) show = false;
        if (q){
          const txt = tr.__cachedText || (tr.__cachedText = textOfRow(tr));
          if (!txt.includes(q)) show = false;
        }
        tr.style.display = show ? '' : 'none';
        if (show) visibleInGroup++;
      });
      // Show subcategory header if any item in group is visible; hide otherwise
      header.style.display = visibleInGroup > 0 ? '' : 'none';
    });
  }

  // expose for other scripts if needed
  window.applyFilters = applyFilters;

  // events
  if (qInput){
    qInput.addEventListener('input', () => applyFilters());
  }
  if (newOnlyCb){
    newOnlyCb.addEventListener('change', () => applyFilters());
  }
  if (distOnlyCb){
    distOnlyCb.addEventListener('change', () => applyFilters());
  }

  // initial run
  applyFilters();
});
</script>

<script>
(function(){
  // --- helpers ---
  const NF = new Intl.NumberFormat('ru-RU');
  const text = el => (el && (el.textContent||'')).trim();

  // resolve column index by header text (robust to changes)
  function findColumnIndex(headerContains){
    const ths = Array.from(document.querySelectorAll('table.price thead th'));
    return ths.findIndex(th => (th.textContent||'').toUpperCase().includes(headerContains));
  }

  // cache base prices once
  let BASE_CACHE_DONE = false;
  function cacheBasePrices(){
    if (BASE_CACHE_DONE) return;
    const priceIdx = findColumnIndex('–¶–ï–ù–ê, –†–£–ë');
    if (priceIdx < 0) return;
    const rows = document.querySelectorAll('table.price tbody tr');
    rows.forEach(tr=>{
      if (tr.classList.contains('subcat')) return;
      const cells = tr.querySelectorAll('td');
      if (cells.length <= priceIdx) return;
      const cell = cells[priceIdx];
      if (!cell) return;
      const raw = text(cell).replace(/\s+/g,'').replace(',','.');
      const val = parseFloat(raw);
      if (!isNaN(val)) cell.dataset.base = String(val);
    });
    BASE_CACHE_DONE = true;
  }

  // apply discount to the base price column only
  function applyDiscountNow(){
    cacheBasePrices();
    const input = document.getElementById('discount');
    const v = parseFloat(input && input.value ? input.value : '0');
    const pct = isNaN(v) ? 0 : Math.max(0, Math.min(99, v));
    const priceIdx = findColumnIndex('–¶–ï–ù–ê, –†–£–ë');
    if (priceIdx < 0) return;

    const rows = document.querySelectorAll('table.price tbody tr');
    rows.forEach(tr=>{
      if (tr.classList.contains('subcat')) return;
      const cells = tr.querySelectorAll('td');
      if (cells.length <= priceIdx) return;
      const cell = cells[priceIdx];
      const base = parseFloat(cell.dataset.base || '');
      if (isNaN(base)) return;
      const newVal = pct>0 ? Math.round(base*(1-pct/100)) : base;
      cell.textContent = NF.format(newVal);
    });
  }

  // reset discount to base
  function resetDiscountNow(){
    const input = document.getElementById('discount');
    if (input) input.value = '0';
    const priceIdx = findColumnIndex('–¶–ï–ù–ê, –†–£–ë');
    if (priceIdx < 0) return;

    const rows = document.querySelectorAll('table.price tbody tr');
    rows.forEach(tr=>{
      if (tr.classList.contains('subcat')) return;
      const cells = tr.querySelectorAll('td');
      if (cells.length <= priceIdx) return;
      const cell = cells[priceIdx];
      const base = parseFloat(cell.dataset.base || '');
      if (!isNaN(base)) cell.textContent = NF.format(base);
    });
  }

  // extend filtering with BF-only checkbox
  function filterBFOnly(){
    const bfOnly = !!(document.getElementById('bfOnly') && document.getElementById('bfOnly').checked);
    if (!bfOnly) return; // nothing to do
    const bfIdx = findColumnIndex('–ß–ï–†–ù–ê–Ø –ü–Ø–¢–ù–ò–¶–ê');
    const rows = document.querySelectorAll('table.price tbody tr');
    rows.forEach(tr=>{
      if (tr.classList.contains('subcat')) return;
      if (tr.style.display === 'none') return; // already hidden by other filters
      const cells = tr.querySelectorAll('td');
      const cell = (bfIdx>=0 && cells.length>bfIdx) ? cells[bfIdx] : null;
      const hasBF = cell && text(cell);
      if (!hasBF) tr.style.display = 'none';
    });
    // hide empty headers
    let counter = 0;
    rows.forEach(tr=>{
      if (tr.classList.contains('subcat')){
        tr.style.display = (counter>0)? '' : 'none';
        counter = 0;
      } else if (tr.style.display !== 'none') counter++;
    });
  }

  // hook existing buttons without breaking old handlers
  document.addEventListener('DOMContentLoaded', ()=>{
    cacheBasePrices();

    const applyBtn = document.getElementById('applyDiscount');
    const resetBtn = document.getElementById('resetDiscount');
    if (applyBtn && !applyBtn.__bfBound){
      applyBtn.addEventListener('click', ()=>{
        applyDiscountNow();
        if (typeof window.applyFilters === 'function') window.applyFilters();
        filterBFOnly();
      });
      applyBtn.__bfBound = true;
    }
    if (resetBtn && !resetBtn.__bfBound){
      resetBtn.addEventListener('click', ()=>{
        resetDiscountNow();
        if (typeof window.applyFilters === 'function') window.applyFilters();
        filterBFOnly();
      });
      resetBtn.__bfBound = true;
    }

    // When BF checkbox toggles, re-run filters
    const bfCb = document.getElementById('bfOnly');
    if (bfCb && !bfCb.__bfBound){
      bfCb.addEventListener('change', ()=>{
        // First run the standard filters so other criteria (search, promo, etc.) apply
        if (typeof window.applyFilters === 'function') window.applyFilters();
        // Then apply the Black Friday only filter
        filterBFOnly();
        // After hiding/showing rows, recalculate category visibility and update summary counts
        if (typeof hideEmptyCategories === 'function') hideEmptyCategories();
        if (typeof updateSummaryRows === 'function') updateSummaryRows();
      });
      bfCb.__bfBound = true;
    }

    // After any initial filtering, apply BF refinement if active
    if (typeof window.applyFilters === 'function'){
      const orig = window.applyFilters;
      window.applyFilters = function(){
        orig();
        filterBFOnly();
      };
    } else {
      // if no global filter, still support BF only
      document.addEventListener('input', filterBFOnly);
    }
  });
})();
</script>

<script>
// Added script to apply discount across all price columns (base, promo, Black Friday) and hide empty categories after filtering. (disabled by patch)
// This script runs after all other scripts and hooks into existing apply filters and discount buttons.
(function(){
  const NF = new Intl.NumberFormat('ru-RU');
  // discount percentage (0-99)
  let discountPct = 0;
  // whether we have cached original values
  let baseCached = false;

  // Utility: find column index in the table header by partial header text (uppercase)
  function findColumnIndex(headerContains){
    const ths = Array.from(document.querySelectorAll('table.price thead th'));
    const idx = ths.findIndex(th => (th.textContent || '').toUpperCase().includes(headerContains));
    return idx;
  }

  // Cache original numeric values for price, promo and Black Friday columns in data attributes.
  function cacheBaseValues(){
    if (baseCached) return;
    const priceIdx = findColumnIndex('–¶–ï–ù–ê, –†–£–ë');
    const promoIdx = findColumnIndex('–ê–ö–¶–ò–Ø');
    const bfIdx    = findColumnIndex('–ß–ï–†–ù–ê–Ø –ü–Ø–¢–ù–ò–¶–ê');
    const rows = document.querySelectorAll('table.price tbody tr');
    rows.forEach(tr=>{
      // Skip category rows
      if (tr.classList.contains('subcat')) return;
      const cells = tr.querySelectorAll('td');
      // Price column
      [priceIdx, promoIdx, bfIdx].forEach((colIdx) => {
        if (colIdx < 0 || colIdx >= cells.length) return;
        const cell = cells[colIdx];
        // Only cache once
        if (cell.dataset.origVal !== undefined) return;
        const txt = (cell.textContent || '').trim();
        // Save original formatted text for reset
        cell.dataset.origText = txt;
        // Extract numeric value (remove spaces and replace comma with dot)
        const num = parseFloat(txt.replace(/\s+/g,'').replace(',','.'));
        if (!isNaN(num)) {
          cell.dataset.origVal = String(num);
        } else {
          cell.dataset.origVal = '';
        }
      });
    });
    baseCached = true;
  }

  // Apply discount to all cached columns. Uses discountPct to recalculate new numbers.
  function applyDiscountToAll(){
    cacheBaseValues();
    const priceIdx = findColumnIndex('–¶–ï–ù–ê, –†–£–ë');
    const promoIdx = findColumnIndex('–ê–ö–¶–ò–Ø');
    const bfIdx    = findColumnIndex('–ß–ï–†–ù–ê–Ø –ü–Ø–¢–ù–ò–¶–ê');
    const rows = document.querySelectorAll('table.price tbody tr');
    rows.forEach(tr=>{
      if (tr.classList.contains('subcat')) return;
      const cells = tr.querySelectorAll('td');
      [priceIdx, promoIdx, bfIdx].forEach((colIdx) => {
        if (colIdx < 0 || colIdx >= cells.length) return;
        const cell = cells[colIdx];
        const baseStr = cell.dataset.origVal || '';
        const base = parseFloat(baseStr);
        // If there's no numeric base value, skip updating this cell
        if (isNaN(base)) return;
        const newVal = discountPct > 0 ? Math.round(base * (1 - discountPct/100)) : base;
        cell.textContent = NF.format(newVal);
      });
    });
  }

  // Reset all discounted columns back to their original values
  function resetPricesToOriginal(){
    cacheBaseValues();
    const priceIdx = findColumnIndex('–¶–ï–ù–ê, –†–£–ë');
    const promoIdx = findColumnIndex('–ê–ö–¶–ò–Ø');
    const bfIdx    = findColumnIndex('–ß–ï–†–ù–ê–Ø –ü–Ø–¢–ù–ò–¶–ê');
    const rows = document.querySelectorAll('table.price tbody tr');
    rows.forEach(tr=>{
      if (tr.classList.contains('subcat')) return;
      const cells = tr.querySelectorAll('td');
      [priceIdx, promoIdx, bfIdx].forEach((colIdx) => {
        if (colIdx < 0 || colIdx >= cells.length) return;
        const cell = cells[colIdx];
        if (cell.dataset.origText !== undefined) {
          cell.textContent = cell.dataset.origText;
        }
      });
    });
  }

  // Hide category rows (subcat) that have no visible items
  function hideEmptyCategories(){
    const rows = document.querySelectorAll('table.price tbody tr');
    let visibleCount = 0;
    let prevHeader = null;
    rows.forEach(tr => {
      // Always show summary rows and never count them
      if (tr.hasAttribute('data-summary')){
        tr.style.display = '';
        return;
      }
      if (tr.classList.contains('subcat')){
        // When hitting a new header row, update the previous header (if it exists and is not a summary row)
        if (prevHeader && !prevHeader.hasAttribute('data-summary')){
          prevHeader.style.display = visibleCount > 0 ? '' : 'none';
        }
        // Reset counter for items after this header
        visibleCount = 0;
        // Save this header as the last encountered header
        prevHeader = tr;
      } else {
        // Count only visible (not display:none) item rows
        if (tr.style.display !== 'none'){
          visibleCount++;
        }
      }
    });
    // After iterating, update the last header if it is not a summary row
    if (prevHeader && !prevHeader.hasAttribute('data-summary')){
      prevHeader.style.display = visibleCount > 0 ? '' : 'none';
    }
  }

  // -------------------------------------------------------------------
  // Summary row helpers
  // Create or retrieve a summary row (general or distributor) and insert
  // it at the top of the tbody. The row is marked with data-summary
  // attribute and has class "summary-row" for styling. A single td is
  // created with colSpan equal to the number of columns in the table.
  function ensureSummaryRow(id){
    const tbody = document.querySelector('table.price tbody');
    if (!tbody) return null;
    let tr = tbody.querySelector('tr[data-summary="' + id + '"]');
    if (!tr){
      tr = document.createElement('tr');
      tr.className = 'summary-row';
      tr.setAttribute('data-summary', id);
      const td = document.createElement('td');
      // Determine number of columns from the table header (th count)
      const theadRow = document.querySelector('table.price thead tr');
      const colCount = theadRow ? theadRow.children.length : 10;
      td.colSpan = colCount;
      tr.appendChild(td);
      // Insert at top of tbody
      tbody.insertBefore(tr, tbody.firstChild);
    }
    return tr;
  }

  // Recalculate and update summary rows (general and distributor counts)
  function updateSummaryRows(){
    const tbody = document.querySelector('table.price tbody');
    if (!tbody) return;
    // Rows that are actual items (not category headers and not summary rows)
    const rows = Array.from(tbody.querySelectorAll('tr')).filter(tr => !tr.classList.contains('subcat') && !tr.hasAttribute('data-summary'));
    let general = 0, distributor = 0;
    rows.forEach(tr => {
      if (tr.style.display === 'none') return;
      if (tr.classList.contains('distributor-row')) distributor++;
      else general++;
    });
    const genTr = ensureSummaryRow('general');
    const distTr = ensureSummaryRow('distributor');
    if (genTr) genTr.querySelector('td').innerHTML = '<b>–û–±—â–∏–π (' + general + ' –ø–æ–∑.)</b>';
    if (distTr) distTr.querySelector('td').innerHTML = '<b>–î–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä (' + distributor + ' –ø–æ–∑.)</b>';
  }

  // Hook into existing filters to apply discount and hide empty categories
  document.addEventListener('DOMContentLoaded', ()=>{
    cacheBaseValues();
    // Override global applyFilters if exists
    if (typeof window.applyFilters === 'function'){
      const oldApply = window.applyFilters;
      window.applyFilters = function(){
        oldApply.apply(this, arguments);
        // After filtering, clear cached flag so new cloned rows can be cached again
        baseCached = false;
        // Hide empty categories
        hideEmptyCategories();
        // Reapply discount or reset according to current discount
        if (discountPct > 0){
          applyDiscountToAll();
        } else {
          resetPricesToOriginal();
        }
        // Update summary rows if the function exists
        if (typeof updateSummaryRows === 'function') {
          try { updateSummaryRows(); } catch(e) {}
        }
      };
    } else {
      // If no filter function, still hide categories on input events
      document.addEventListener('input', hideEmptyCategories);
    }
    // Bind discount buttons
    const applyBtn = document.getElementById('applyDiscount');
    const resetBtn = document.getElementById('resetDiscount');
    const discountInput = document.getElementById('discount');
    if (applyBtn){
      applyBtn.addEventListener('click', ()=>{
        const v = parseFloat(discountInput && discountInput.value ? discountInput.value : '0');
        discountPct = isNaN(v) ? 0 : Math.max(0, Math.min(99, v));
        // ensure input is sanitized
        if (discountInput) discountInput.value = String(discountPct);
        // Trigger filters which will call our override
        if (typeof window.applyFilters === 'function'){
          window.applyFilters();
        } else {
          // If no filters, just apply discount
          applyDiscountToAll();
        }
      });
    }
    if (resetBtn){
      resetBtn.addEventListener('click', ()=>{
        discountPct = 0;
        if (discountInput) discountInput.value = '0';
        if (typeof window.applyFilters === 'function'){
          window.applyFilters();
        } else {
          resetPricesToOriginal();
        }
      });
    }
    // After initial setup and binding, insert and update summary rows
    // Use a short timeout to ensure any initial filters (e.g. default applyFilters) have run
    setTimeout(() => {
      try {
        // Trigger initial filtering to populate any cloned rows. This will also update summary rows via our hook.
        if (typeof window.applyFilters === 'function') {
          window.applyFilters();
        } else {
          // If applyFilters is not present, still update categories and counts
          if (typeof hideEmptyCategories === 'function') hideEmptyCategories();
          if (typeof updateSummaryRows === 'function') updateSummaryRows();
        }
      } catch(e) {}
    }, 50);
  });
})();
</script>

</body>
</html>
